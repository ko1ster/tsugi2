<script>
  (function () {
    var _productCache = {};

    /**
     * Caches requested products if requested with this behavior.
     *
     * @behavior
     */
    TH.behaviors.productCache = {

      /**
       * Straightforward async memo function.
       *
       * @param {String} id
       * @returns {Promise}
       * @private
       */
      _readProduct: function(id) {
        if (_productCache[id]) {
          // Found in cache, return cached
          // promise, which may be resolved many times on demand
          return _productCache[id];
        } else {
          // Do a request to API, caching the request promise
          return (_productCache[id] = this.user.product(id).read());
        }
      }
    };
  })();
</script>
